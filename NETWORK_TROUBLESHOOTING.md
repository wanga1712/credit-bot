# Решение проблем с подключением к Telegram API

## Проблема: `httpx.ConnectTimeout` или `telegram.error.TimedOut`

Если вы видите ошибки таймаута подключения, это означает, что сервер не может подключиться к `api.telegram.org`.

## Диагностика

### 1. Проверьте доступность Telegram API

Выполните на сервере:

```bash
# Проверка доступности API
curl -I https://api.telegram.org

# Или более детальная проверка
curl -v https://api.telegram.org/bot<YOUR_TOKEN>/getMe
```

Если команды не выполняются или выдают ошибку таймаута, проблема в сетевом подключении.

### 2. Проверьте файрвол

```bash
# Проверьте, не блокирует ли файрвол исходящие соединения
sudo iptables -L -n | grep telegram
# или
sudo ufw status
```

### 3. Проверьте DNS

```bash
# Проверьте разрешение DNS
nslookup api.telegram.org
# или
dig api.telegram.org
```

## Решения

### Решение 1: Использование прокси (если Telegram заблокирован)

Если Telegram API заблокирован в вашей стране/сети, используйте прокси:

1. **Добавьте прокси в файл `.env`:**

```bash
TELEGRAM_BOT_TOKEN=ваш_токен_здесь
TELEGRAM_PROXY=http://proxy.example.com:8080
```

Или для SOCKS5:
```bash
TELEGRAM_PROXY=socks5://proxy.example.com:1080
```

2. **Перезапустите бота**

### Решение 2: Настройка файрвола

Если файрвол блокирует соединения:

```bash
# Разрешите исходящие HTTPS соединения
sudo ufw allow out 443/tcp
```

### Решение 3: Использование VPN

Если прокси недоступен, используйте VPN на сервере.

### Решение 4: Проверка сетевых настроек сервера

```bash
# Проверьте маршрутизацию
traceroute api.telegram.org

# Проверьте доступность через другой порт
telnet api.telegram.org 443
```

## Автоматические повторы

Бот автоматически пытается переподключиться 3 раза с задержкой 5 секунд между попытками. Если все попытки неудачны, проверьте сетевые настройки.

## Увеличенные таймауты

В коде уже настроены увеличенные таймауты:
- `connect_timeout`: 30 секунд
- `read_timeout`: 30 секунд  
- `write_timeout`: 30 секунд

Если этого недостаточно, можно увеличить значения в коде.

